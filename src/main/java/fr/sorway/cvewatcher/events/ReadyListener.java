package fr.sorway.cvewatcher.events;

import fr.sorway.cvewatcher.CVEWatcher;
import fr.sorway.cvewatcher.tasks.SearchCVETask;
import net.dv8tion.jda.api.events.session.ReadyEvent;
import net.dv8tion.jda.api.hooks.ListenerAdapter;
import org.jetbrains.annotations.NotNull;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.concurrent.TimeUnit;

public class ReadyListener extends ListenerAdapter {
    private final Logger logger = LoggerFactory.getLogger(ReadyListener.class);
    private final CVEWatcher cveWatcher;

    public ReadyListener(CVEWatcher cveWatcher) {
        this.cveWatcher = cveWatcher;
    }

    @Override
    public void onReady(@NotNull ReadyEvent event) {
        logger.info("\uD83E\uDD16 Connected as {}", event.getJDA().getSelfUser().getName());

        logger.info("Starting task of finding CVE vulnerabilities.");
        cveWatcher.getScheduler().scheduleAtFixedRate(new SearchCVETask(cveWatcher), 0, 5, TimeUnit.MINUTES);
    }
}
